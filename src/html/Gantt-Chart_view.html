<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="theme-color" content="#000000">
    <link rel="icon" href="./favicon.ico">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">
    <title>Gantt-Chart</title>
    <link href="../components/common/header/header.css" rel="stylesheet">
    <link href="../components/common/sidebar/sidebar.css" rel="stylesheet">
    <link href="../components/common/sidebar/sidebar-option.css" rel="stylesheet">
    <link href="../css/gantt.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.dhtmlx.com/gantt/edge/dhtmlxgantt.css">
    <script src="https://cdn.dhtmlx.com/gantt/edge/dhtmlxgantt.js"></script>
</head>

<body style="display: block; margin: auto;">
    <div id="root">
        <div class="gantt-container">
            <div class="header">
                <div class="header-menu">
                    <i class="bi bi-columns-gap"></i>
                </div>
                <div class="header-leftFold">
                    <label class="header-label">Quinones</label>
                </div>
                <div class="header-rightFold">
                    <div class="header-search">
                        <i class="bi bi-search"></i>
                        <input placeholder="Search">
                    </div>
                    <div class="header-profile">
                        <div class="header-options">
                            <i class="bi bi-three-dots" onclick="toggleMenu()">
                                <div class="sub-menu-wrap" id="subMenu">
                                    <div class="sub-menu">
                                        <!--
                                    <div class="options-info">
                                        <h2>ADDD</h2>
                                    </div>
                                    -->
                                        <!--<hr>-->
                                        <a href="#" class="sub-menu-link">
                                            <p>Edit Profile</p>

                                        </a>
                                        <a href="#" class="sub-menu-link">
                                            <p>Settings & Privacy</p>

                                        </a>
                                        <a href="#" class="sub-menu-link">
                                            <p>Help & Support</p>

                                        </a>
                                        <a href="#" class="sub-menu-link">
                                            <p>Logout</p>

                                        </a>
                                    </div>
                                </div>
                            </i>
                        </div>
                        <a href="UserProfile_view.html">
                            <div class="header-icon">
                                <i class="bi bi-person-circle"></i>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
            <div class="gantt-body">
                <!---------------------------------------------------------------------------------------------->
                <div class="gantt-sidebar">
                    <div class="sidebar">
                        <div class="sidebar-top">


                            <div class="sidebar-option">
                                <a href="Home_view.html">
                                    <div class="sidebar-icon">
                                        <i class="bi bi-house"></i>
                                    </div>
                                </a>
                                <label class="sidebar-label">Home</label>
                            </div>



                            <div class="sidebar-option">
                                <a href="Requests_view.html">
                                    <div class="sidebar-icon">
                                        <i class="bi bi-people-fill"></i>
                                    </div>
                                </a>
                                <label class="sidebar-label">Requests</label>
                            </div>

                            <div class="sidebar-option">
                                <a href="Chat_view.html">
                                    <div class="sidebar-icon">
                                        <i class="bi bi-chat-dots"></i>
                                    </div>
                                </a>
                                <label class="sidebar-label">Chat</label>
                            </div>

                            <div class="sidebar-option">
                                <a href="Task_view.html">
                                    <div class="sidebar-icon">
                                        <i class="bi bi-file-text"></i>
                                    </div>
                                </a>
                                <label class="sidebar-label">Task</label>
                            </div>

                            <div class="sidebar-option active">
                                <a href="Gantt-Chart_view.html">
                                    <div class="sidebar-icon">
                                        <i class="bi bi-bar-chart-steps"></i>
                                    </div>
                                </a>
                                <label class="sidebar-label">Gantt-Chart</label>
                            </div>

                            <div class="sidebar-option">
                                <a href="Calender_view.html">
                                    <div class="sidebar-icon">
                                        <i class="bi bi-calendar"></i>
                                    </div>
                                </a>
                                <label class="sidebar-label">Calender</label>
                            </div>

                            <div class="sidebar-option">
                                <a href="call-view.html">
                                    <div class="sidebar-icon">
                                        <i class="bi bi-telephone"></i>
                                    </div>
                                </a>
                                <label class="sidebar-label">Calls</label>
                            </div>

                            <div class="sidebar-option">
                                <a href="Files_view.html">
                                    <div class="sidebar-icon">
                                        <i class="bi bi-folder"></i>
                                    </div>
                                </a>
                                <label class="sidebar-label">Files</label>
                            </div>
                        </div>
                        <div class="sidebar-bottom">
                            <div class="sidebar-option">
                                <a href="Help_view.html">
                                    <div class="sidebar-icon">
                                        <i class="bi bi-question-circle"></i>
                                    </div>
                                </a>
                                <label class="sidebar-label">Help</label>
                            </div>
                        </div>
                        <!---------------------------------------------------------------------------------------------->
                    </div>
                </div>

                <div class="gantt-rightFold"><!-----Beginning of Right Fold (Note uses components/calls/home.css)-->
                    <div class="rightFold">
                        <div class="fold-container">
                            <h2>Gantt-Chart</h2>
                            <div id="gantt_here" style="width: 99%; height: 85%;"></div>
                            <script>

                                const mysql = require('mysql');

                                // Connection details for MySQL database
                                const connection = mysql.createConnection({
                                    host: 'localhost',
                                    user: 'root',
                                    password: 'password',
                                    database: 'capstone'
                                });

                                // Connect to MySQL database
                                connection.connect();

                                // Retrieve user IDs from MySQL database
                                const users = [];
                                connection.query('SELECT id, FirstName FROM users', (error, results, fields) => {
                                    if (error) throw error;
                                    results.forEach((result) => {
                                        users.push({
                                            key: result.id,
                                            label: result.FirstName
                                        });
                                    });
                                });

                                // Function to get the user's first name based on the user ID
                                function getUserFirstName(user_id) {
                                    for (var i = 0; i < users.length; i++) {
                                        if (users[i].key == user_id) {
                                            return users[i].label;
                                        }
                                    }
                                    return "";
                                }

                                gantt.config.columns = [
                                    //{ name: "text", label: "Task Name", width: "*", tree: true },
                                    { name: "text", label: "Task Name", width: "*", align: "center" },
                                    { name: "text", label: "Phase", width: "*", align: "center" },
                                    { name: "start_date", label: "Start time", align: "center" },
                                    { name: "due_date", label: "Due Date", align: "center" },
                                    { name: "duration", label: "Duration", align: "center" },
                                    // Owners column
                                    {
                                        name: "user_id", label: "Assign To", align: "center", template: function (obj) {
                                            return getUserFirstName(obj.user_id);
                                        }
                                    },
                                    { name: "add", label: "", width: 44 }
                                ];

                                // Configuring lightbox
                                gantt.config.lightbox.sections = [
                                    // Owners section, will map to owner_id
                                    {
                                        name: "users", height: 22, map_to: "user_id", type: "select", options: users, onchange: function (task, value) {
                                            task.user_id = value;
                                            task.user = getUserFirstName(value);
                                            //gantt.updateTask(task.id);
                                        }
                                    },
                                    { name: "description", height: 70, map_to: "text", type: "textarea", focus: true },
                                    { name: "time", height: 72, map_to: "auto", type: "duration" }
                                ]
                                gantt.locale.labels.section_users = "User";
                                gantt.init("gantt_here");
                            </script>
                        </div>
                    </div>
                </div><!-----End of Right Fold -->
            </div>
            <script>
                let subMenu = document.getElementById("subMenu");
                function toggleMenu() {
                    subMenu.classList.toggle("open-menu");
                }
            </script>
</body>

</html>